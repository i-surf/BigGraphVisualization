@()

@defining(play.core.PlayVersion.current) { version =>

    <html>

        <title>Reply Tweets Deck.GL</title>
        <meta name='viewport' />

        <style type="text/css">
                body {
                    margin: 0;
                }
                #container {
                    width: 100%;
                    height: 100%;
                }
                #search{
                    left:500px;
                    top:0px;
                    position:absolute;
                }
        </style>

        <body>

            <div id="graph-container" style="width: 1000px; height: 800px;">
            </div>

            <div id="map" style="width:100vw; height: 100vh"></div>
            <div id = "search">
                <p id="content">Reply Tweets Dataset</p>

                <<!-- input box -> query -->
                <input type="text" class="div" id="query"
                placeholder="Search number of nodes, range from 1-10000, e.g.500. The default value is 5.">
                <button onclick="requestHttp()">submit</button>
            </div>
        </body>

@*      copied from https://jsfiddle.net/sim51/xck9a7yf/?utm_source=website&utm_medium=embed&utm_campaign=xck9a7yf*@
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/sigma.core.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/conrad.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/utils/sigma.utils.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/utils/sigma.polyfills.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/sigma.settings.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/classes/sigma.classes.dispatcher.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/classes/sigma.classes.configurable.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/classes/sigma.classes.graph.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/classes/sigma.classes.camera.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/classes/sigma.classes.quad.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/classes/sigma.classes.edgequad.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/captors/sigma.captors.mouse.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/captors/sigma.captors.touch.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/sigma.renderers.canvas.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/sigma.renderers.webgl.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/sigma.renderers.svg.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/sigma.renderers.def.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.labels.def.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.hovers.def.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.nodes.def.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.edges.def.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.edges.curve.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/canvas/sigma.canvas.extremities.def.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/webgl/sigma.webgl.edges.def.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/webgl/sigma.webgl.edges.fast.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/webgl/sigma.webgl.edges.thickLine.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/webgl/sigma.webgl.edges.thickLineCPU.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/webgl/sigma.webgl.edges.thickLineGPU.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/webgl/sigma.webgl.nodes.def.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/renderers/webgl/sigma.webgl.nodes.fast.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/middlewares/sigma.middlewares.rescale.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/middlewares/sigma.middlewares.copy.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/misc/sigma.misc.animation.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/misc/sigma.misc.bindEvents.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/misc/sigma.misc.bindDOMEvents.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/src/misc/sigma.misc.drawHovers.js"></script>
            <!-- Sigma plugins -->
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/plugins/sigma.layout.forceAtlas2/supervisor.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sigma@@1.2.1/plugins/sigma.layout.forceAtlas2/worker.js"></script>
@*      copied ---- end ----*@

@*        <script src="/assets/javascripts/sigma.min.js"></script>*@

        <script src="/assets/javascripts/deckgl.min.js"></script>
        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js'></script>
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />

        <script>
                title_list  =[]
                to_list=[]

                global_nodes_title = [] // store ids(titles) of added nodes
                //var global_edges = []

                function requestHttp() {
                    query = document.getElementById("query").value;
                    console.log("query = " + query);

                    var request = new XMLHttpRequest();
                    request.open('GET', 'http://localhost:9000/test2?query=' + query, false);
                    request.send(null);

                    if (request.status === 200) {
                        var data = JSON.parse(request.responseText); // a result of request
                        var title_list_ = data.title_list;
                        var title_list_len = title_list_.length;

                        title_list_ = title_list_.substring(1, title_list_len - 1);
                        title_list = title_list_.split(',');

                        //to_list
                        var to_list_ = data.to_list; // [ㅁ,ㅁ],,[ㅁ],,[ㅁ,ㅁ,ㅁ],,
                        var list_list = to_list_.split(",,"); // a list which contains lists

                        // list_list to a real double_list
                        for (var i = 0; i < list_list.length; i++) {
                            var list = list_list[i];
                            list = list.substring(1, list.length - 1);
                            tmp_list = list.split(','); //string to list
                            to_list.push(tmp_list);
                        }

                        drawGraph();
                    } else {
                        console.log("response error");
                    }
                }

                function drawGraph(){

                    var s = new sigma({
                        //graph: g,
                        //container: 'graph-container',
                        renderer: {
                            container: document.getElementById('graph-container'),
                            type: 'WebGL'
                            //type: 'canvas'
                        },
                        settings: { // change the size of the node depending on the number of data
                            minNodeSize: 8, // node label is shown if it is bigger than 7
                            maxNodeSize: 8, // node label is shown if it is bigger than 7
                            maxEdgeSize: 1, // 3 or 4
                            doubleClickEnabled: false,
                            arrowSizeRatio: 2
                            /*
                               each graph is formed based on center of circle
                               It seems to mean the degree of spreadability
                               If I set as 30, it goes out of the screen.
                               1 maybe vary.
                            */
                        }
                    });

                    //var s = new sigma('container'); //그래프 그리기 시작
                    var g = {
                        nodes: [],
                        edges: []
                    };

                    var title_list_cnt = title_list.length;
                    global_edges = 0;

                    //push a node to a graph object
                    for (var idx=0; idx<title_list_cnt; idx++) {
                        g.nodes.push({
                            //s.graph.addNode({
                            id: title_list[idx],
                            label: title_list[idx],
                            x: Math.random(),
                            y: Math.random(),
                            size: 1,
                            color: '#f00'
                        });

                        global_nodes_title.push(title_list[idx]);
                    }

                    // connect edges
                    for (var i=0; i<title_list_cnt; i++){
                        for (var j=0; j<to_list[i].length; j++){
                            if(global_nodes_title.includes(to_list[i][j])===false){
                                // first, make a node
                                g.nodes.push({
                                    //s.graph.addNode({
                                    id: to_list[i][j],
                                    label: to_list[i][j],
                                    x: Math.random(),
                                    y: Math.random(),
                                    size: 1,
                                    color: '#f00'
                                });

                                // mark that node is made
                                global_nodes_title.push(to_list[i][j]);

                                //connect edges
                                g.edges.push({
                                    id : global_edges,
                                    source: title_list[i],
                                    target: to_list[i][j],
                                    size: 3,
                                    color: '#00f',
                                    type:'arrow'
                                });
                            }

                            // if it is an exist node
                            else{
                                g.edges.push({
                                    id : global_edges,
                                    source: title_list[i],
                                    target: to_list[i][j],
                                    size: 3,
                                    color: '#00f',
                                    type:'arrow'
                                });
                            }

                            global_edges += 1;
                        }
                    }

                    // load the graph
                    s.graph.read(g);

                    // draw the graph
                    s.refresh();

                    // launch force-atlas with parameters
                    // https://github.com/jacomyal/sigma.js/tree/master/plugins/sigma.layout.forceAtlas2
                    s.startForceAtlas2({
                        linLogMode : true, //clusters more tight.
                        //outboundAttractionDistribution : true,
                        //adjustSizes : true,
                        //edgeWeightInfluence : 1, //0 = no influence, 1 = normal
                        scalingRatio : 1, //how much repulsion you want. More makes a more sparse graph.
                        strongGravityMode : false,
                        //gravity : 1, //attracts nodes to the center. Prevents islands from drifting away.
                        barnesHutOptimize: true, //to improve repulsion's scalability, useful for large graph but harmful to small ones.
                        barnesHutTheta : 1,
                        slowDown : 1,
                        //startingIterations : 1, //number of iterations to be run before the first render.
                        //iterationsPerRender : 2, //number of iterations to be run before each render.
                        worker: true //?
                    });

                    // can control the duration of an effect
                    window.setTimeout(function() {s.killForceAtlas2()}, 10000);
                }
        </script>
    </html>
}}}



